---
name: e2e scenario test
description: an example of using the podman provisioner

provision:
  - name: test_driver
    provisioner: podman
    groups:
      - test_drivers
    image: "fedora"
    network_mode: "host"
    privileged: true
    remove: true
    tty: true
    # remote:
    #   user: jbpratt
    #   identity: "{{ HOME }}/.ssh/id_rsa"
    #   uri: ssh://jbpratt@desktop/run/user/1000/podman/podman.sock
    volumes:
      - "/tmp/:/tests"
    ports:
      - "8080:80/tcp"
    ansible_params:
      ansible_connection: podman
    environment:
      - "SOMEVAR=helloworld"
    additional_args:
      - "-w /tests"

orchestrate:
  - name: Execute a playbook on the container
    orchestrator: ansible
    hosts: test_drivers
    ansible_playbook:
      name: tests/e2e/test.yml
    ansible_galaxy_options:
      role_file: tests/e2e/requirements.yml
